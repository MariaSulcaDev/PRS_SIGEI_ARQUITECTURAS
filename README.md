# ğŸ—ï¸ ARQUITECTURA SIGEI - Sistema Integrado de GestiÃ³n Educativa Inicial

## Arquitectura de Microservicios con DDD, Arquitectura Hexagonal y Multi-Tenancy

---

## ğŸ“‘ Ãndice

1. [VisiÃ³n General](#1-visiÃ³n-general)
2. [Stack TecnolÃ³gico](#2-stack-tecnolÃ³gico)
3. [Arquitectura de Alto Nivel](#3-arquitectura-de-alto-nivel)
4. [PatrÃ³n Multi-Tenant](#4-patrÃ³n-multi-tenant)
5. [Microservicios del Sistema](#5-microservicios-del-sistema)
6. [Arquitectura Hexagonal + DDD](#6-arquitectura-hexagonal--ddd)
7. [API Gateway con Spring Cloud Gateway](#7-api-gateway-con-spring-cloud-gateway)
8. [Service Discovery con Eureka](#8-service-discovery-con-eureka)
9. [Seguridad con Keycloak](#9-seguridad-con-keycloak)
10. [Event-Driven Architecture](#10-event-Driven-Architecture-con-RabbitMQ)
11. [Estructura de Carpetas Estandarizada](#11-estructura-de-carpetas-estandarizada)
12. [ConfiguraciÃ³n Centralizada](#12-configuraciÃ³n-centralizada)
13. [Observabilidad](#13-observabilidad)
14. [Despliegue](#14-despliegue)

---

## 1. VisiÃ³n General

### 1.1 DescripciÃ³n del Sistema

**SIGEI** es un sistema de gestiÃ³n educativa diseÃ±ado especÃ­ficamente para colegios de nivel inicial en PerÃº. El sistema es **multi-tenant**, permitiendo que mÃºltiples instituciones educativas operen de forma aislada en la misma infraestructura.

### 1.2 Objetivos ArquitectÃ³nicos

| Objetivo | DescripciÃ³n |
|----------|-------------|
| **Escalabilidad** | Escalar horizontalmente segÃºn demanda |
| **Multi-Tenancy** | Aislamiento completo entre instituciones |
| **Mantenibilidad** | CÃ³digo limpio, modular y testeable |
| **Resiliencia** | Tolerancia a fallos, circuit breakers |
| **Seguridad** | AutenticaciÃ³n/AutorizaciÃ³n centralizada |
| **Observabilidad** | Logs, mÃ©tricas y trazabilidad distribuida |

### 1.3 Principios de DiseÃ±o

- **Domain-Driven Design (DDD)**: Modelado basado en el dominio del negocio
- **Arquitectura Hexagonal**: SeparaciÃ³n clara entre dominio e infraestructura
- **Event-Driven**: ComunicaciÃ³n asÃ­ncrona entre microservicios
- **API-First**: Contratos de API documentados con OpenAPI
- **12-Factor App**: Mejores prÃ¡cticas para aplicaciones cloud-native

---

## 2. Stack TecnolÃ³gico

### 2.1 Versiones Estandarizadas

| TecnologÃ­a | VersiÃ³n | PropÃ³sito |
|------------|---------|-----------|
| **Java** | 17 LTS | Lenguaje base |
| **Spring Boot** | 3.5.10 | Framework principal |
| **Spring Cloud** | 2024.0.x | Microservicios |
| **Spring WebFlux** | 3.5.10 | ProgramaciÃ³n reactiva |
| **Spring Data R2DBC** | 3.5.10 | Acceso reactivo a BD |
| **Spring Security** | 6.x | Seguridad |
| **Keycloak** | 24.x | Identity Provider |
| **PostgreSQL** | 16.x | Base de datos principal |
| **MongoDB** | 7.x | Datos no estructurados |
| **RabbitMQ** | 3.13.x | MensajerÃ­a (mÃ¡s simple que Kafka) |
| **Redis** | 7.x | CachÃ© distribuido |
| **Docker** | 25.x | ContainerizaciÃ³n |
| **Docker Compose** | 2.x | OrquestaciÃ³n en VPC |

### 2.2 Â¿Por quÃ© RabbitMQ y no Kafka?

| CaracterÃ­stica | RabbitMQ | Apache Kafka |
|----------------|----------|--------------|
| **Curva de aprendizaje** | âœ… Baja - FÃ¡cil para el equipo | âŒ Alta - Requiere expertise |
| **ConfiguraciÃ³n** | âœ… Simple - Menos componentes | âŒ Compleja - ZooKeeper/KRaft |
| **Recursos** | âœ… Menos RAM/CPU requerido | âŒ Requiere mÃ¡s recursos |
| **Caso de uso** | âœ… Colas de tareas, notificaciones | âš ï¸ Event streaming masivo |
| **Debugging** | âœ… UI Admin incluida | âš ï¸ Requiere Kafka UI adicional |
| **Dead Letter Queue** | âœ… Nativo y simple | âš ï¸ ConfiguraciÃ³n manual |
| **Ideal para** | âœ… Equipos pequeÃ±os/medianos | âš ï¸ Empresas grandes |

**DecisiÃ³n: RabbitMQ** - Mejor para un equipo en desarrollo, mÃ¡s fÃ¡cil de mantener y debuggear.

### 2.2 Dependencias Maven EstÃ¡ndar

```xml
<!-- Parent POM estandarizado -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.5.10</version>
</parent>

<properties>
    <java.version>17</java.version>
    <spring-cloud.version>2024.0.0</spring-cloud.version>
    <springdoc.version>2.8.8</springdoc.version>
    <mapstruct.version>1.6.3</mapstruct.version>
    <testcontainers.version>1.19.8</testcontainers.version>
</properties>

<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>${spring-cloud.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

---

## 3. Arquitectura de Alto Nivel

### 3.1 Diagrama de Arquitectura

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                        FRONTEND                             â”‚
                                    â”‚                    React 19 + TypeScript                    â”‚
                                    â”‚                     vg-web-sigei                            â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                     API GATEWAY                             â”‚
                                    â”‚               Spring Cloud Gateway                          â”‚
                                    â”‚         (AutenticaciÃ³n, Rate Limiting, Routing)            â”‚
                                    â”‚                    Puerto: 8080                             â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                                    â”‚                                    â”‚
                         â–¼                                    â–¼                                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      KEYCLOAK            â”‚      â”‚    SERVICE DISCOVERY     â”‚      â”‚    CONFIG SERVER         â”‚
          â”‚   Identity Provider      â”‚      â”‚    Eureka Server         â”‚      â”‚  Spring Cloud Config     â”‚
          â”‚   Puerto: 8180           â”‚      â”‚    Puerto: 8761          â”‚      â”‚    Puerto: 8888          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        MICROSERVICIOS DE NEGOCIO                                            â”‚
â”‚                                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ms-institution â”‚  â”‚   ms-users      â”‚  â”‚  ms-students    â”‚  â”‚  ms-academic    â”‚  â”‚ ms-enrollments  â”‚   â”‚
â”‚  â”‚    :9080        â”‚  â”‚    :9081        â”‚  â”‚    :9082        â”‚  â”‚    :9083        â”‚  â”‚    :9084        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                    â”‚                    â”‚                    â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ms-attendance  â”‚  â”‚    ms-grades    â”‚  â”‚  ms-behavior    â”‚  â”‚  ms-psychology  â”‚  â”‚   ms-events     â”‚   â”‚
â”‚  â”‚    :9085        â”‚  â”‚    :9086        â”‚  â”‚    :9087        â”‚  â”‚    :9088        â”‚  â”‚    :9089        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                    â”‚                    â”‚                    â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                  â”‚
â”‚  â”‚ ms-teacher-     â”‚  â”‚ ms-notification â”‚                                                                  â”‚
â”‚  â”‚  assignment     â”‚  â”‚    :9091        â”‚                                                                  â”‚
â”‚  â”‚    :9090        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚
            â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                              MESSAGE BROKER                                                 â”‚
â”‚                                             RabbitMQ 3.13                                                   â”‚
â”‚                                                                                                             â”‚
â”‚   Exchanges: institution | student | attendance | notification | document                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           DATA LAYER                                                        â”‚
â”‚                                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚     PostgreSQL          â”‚  â”‚       MongoDB           â”‚  â”‚        Redis            â”‚                     â”‚
â”‚  â”‚  (Datos relacionales)   â”‚  â”‚   (Datos documentales)  â”‚  â”‚   (Cache, Sessions)     â”‚                     â”‚
â”‚  â”‚                         â”‚  â”‚                         â”‚  â”‚                         â”‚                     â”‚
â”‚  â”‚ â€¢ Enrollments           â”‚  â”‚ â€¢ Institutions          â”‚  â”‚ â€¢ Token cache           â”‚                     â”‚
â”‚  â”‚ â€¢ Attendance            â”‚  â”‚ â€¢ Users                 â”‚  â”‚ â€¢ Session storage       â”‚                     â”‚
â”‚  â”‚ â€¢ Grades                â”‚  â”‚ â€¢ Students              â”‚  â”‚ â€¢ Rate limiting         â”‚                     â”‚
â”‚  â”‚ â€¢ Academic catalog      â”‚  â”‚ â€¢ Notifications         â”‚  â”‚                         â”‚                     â”‚
â”‚  â”‚ â€¢ Events                â”‚  â”‚                         â”‚  â”‚                         â”‚                     â”‚
â”‚  â”‚ â€¢ Teacher assignments   â”‚  â”‚                         â”‚  â”‚                         â”‚                     â”‚
â”‚  â”‚ â€¢ Psychology            â”‚  â”‚                         â”‚  â”‚                         â”‚                     â”‚
â”‚  â”‚ â€¢ Behavior              â”‚  â”‚                         â”‚  â”‚                         â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Flujo de ComunicaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€â–¶â”‚ Gateway â”‚â”€â”€â”€â”€â–¶â”‚   Keycloak  â”‚â”€â”€â”€â”€â–¶â”‚ Microservice â”‚â”€â”€â”€â”€â–¶â”‚  Database   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                 â”‚                    â”‚                   â”‚
     â”‚   1. Request   â”‚                 â”‚                    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                    â”‚                   â”‚
     â”‚                â”‚  2. Validate    â”‚                    â”‚                   â”‚
     â”‚                â”‚     Token       â”‚                    â”‚                   â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚                   â”‚
     â”‚                â”‚  3. Token Info  â”‚                    â”‚                   â”‚
     â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
     â”‚                â”‚  4. Route +     â”‚                    â”‚                   â”‚
     â”‚                â”‚     TenantId    â”‚                    â”‚                   â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
     â”‚                â”‚                 â”‚                    â”‚  5. Query with   â”‚
     â”‚                â”‚                 â”‚                    â”‚     TenantId     â”‚
     â”‚                â”‚                 â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                â”‚                 â”‚                    â”‚  6. Response     â”‚
     â”‚                â”‚                 â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚  7. Response   â”‚                 â”‚                    â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
```

---

## 4. PatrÃ³n Multi-Tenant

### 4.1 Estrategia de Multi-Tenancy

Utilizaremos **Discriminator Column** (columna `tenant_id`) en todas las tablas:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESTRATEGIA: SHARED DATABASE                  â”‚
â”‚                    CON DISCRIMINATOR COLUMN                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PostgreSQL                            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              students                            â”‚    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â”‚
â”‚  â”‚  â”‚ id | tenant_id | first_name | last_name | ...   â”‚    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â”‚
â”‚  â”‚  â”‚ 1  | inst_001  | Juan       | PÃ©rez     | ...   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ 2  | inst_001  | MarÃ­a      | GarcÃ­a    | ...   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ 3  | inst_002  | Pedro      | LÃ³pez     | ...   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ 4  | inst_002  | Ana        | Torres    | ...   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Cada query incluye automÃ¡ticamente:                     â”‚   â”‚
â”‚  â”‚  WHERE tenant_id = :currentTenant                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Ventajas:                                                      â”‚
â”‚  âœ… Menor costo de infraestructura                              â”‚
â”‚  âœ… FÃ¡cil mantenimiento                                         â”‚
â”‚  âœ… Adecuado para colegios pequeÃ±os/medianos                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ImplementaciÃ³n del Tenant Context

```java
// TenantContext.java - ThreadLocal para el tenant actual
public class TenantContext {

    private static final ThreadLocal<String> CURRENT_TENANT = new ThreadLocal<>();

    public static void setTenantId(String tenantId) {
        CURRENT_TENANT.set(tenantId);
    }

    public static String getTenantId() {
        return CURRENT_TENANT.get();
    }

    public static void clear() {
        CURRENT_TENANT.remove();
    }
}

// Para WebFlux (reactivo) usamos Context
public class ReactiveTenantContext {

    public static final String TENANT_ID_KEY = "tenantId";

    public static Mono<String> getTenantId() {
        return Mono.deferContextual(ctx ->
            Mono.just(ctx.getOrDefault(TENANT_ID_KEY, ""))
        );
    }

    public static Function<Context, Context> withTenant(String tenantId) {
        return ctx -> ctx.put(TENANT_ID_KEY, tenantId);
    }
}
```

### 4.3 Filtro de Tenant en Gateway

```java
@Component
public class TenantExtractionFilter implements GlobalFilter, Ordered {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // Extraer tenant del token JWT (claim "institution_id")
        return ReactiveSecurityContextHolder.getContext()
            .map(ctx -> ctx.getAuthentication())
            .cast(JwtAuthenticationToken.class)
            .map(jwt -> jwt.getToken().getClaimAsString("institution_id"))
            .flatMap(tenantId -> {
                // Agregar header X-Tenant-ID para downstream services
                ServerHttpRequest request = exchange.getRequest()
                    .mutate()
                    .header("X-Tenant-ID", tenantId)
                    .build();
                return chain.filter(exchange.mutate().request(request).build());
            });
    }

    @Override
    public int getOrder() {
        return -1; // Ejecutar despuÃ©s de autenticaciÃ³n
    }
}
```

### 4.4 Modelo de Datos con Tenant

```java
// Clase base para todas las entidades con tenant
@MappedSuperclass
public abstract class TenantAwareEntity {

    @Column(name = "tenant_id", nullable = false, updatable = false)
    private String tenantId;

    @PrePersist
    public void prePersist() {
        if (this.tenantId == null) {
            this.tenantId = TenantContext.getTenantId();
        }
    }
}

// Ejemplo de entidad
@Table("students")
public class Student extends TenantAwareEntity {

    @Id
    private UUID id;

    @Column("first_name")
    private String firstName;

    @Column("last_name")
    private String lastName;

    // ... mÃ¡s campos
}
```

---

## 5. Microservicios del Sistema

### 5.1 Inventario de Microservicios

| Microservicio | Puerto | Base de Datos | DescripciÃ³n |
|---------------|--------|---------------|-------------|
| **ms-gateway** | 8080 | - | API Gateway, routing, autenticaciÃ³n |
| **ms-eureka** | 8761 | - | Service Discovery |
| **ms-config** | 8888 | Git repo | ConfiguraciÃ³n centralizada |
| **ms-institution** | 9080 | MongoDB | GestiÃ³n de instituciones y aulas |
| **ms-users** | 9081 | MongoDB | Usuarios del sistema |
| **ms-students** | 9082 | MongoDB | GestiÃ³n de estudiantes |
| **ms-academic** | 9083 | PostgreSQL | CatÃ¡logo acadÃ©mico (cursos, competencias) |
| **ms-enrollments** | 9084 | PostgreSQL | MatrÃ­culas y perÃ­odos acadÃ©micos |
| **ms-attendance** | 9085 | PostgreSQL | Control de asistencias |
| **ms-grades** | 9086 | PostgreSQL | Notas y evaluaciones |
| **ms-behavior** | 9087 | PostgreSQL | Comportamiento e incidentes |
| **ms-psychology** | 9088 | PostgreSQL | Bienestar psicolÃ³gico |
| **ms-events** | 9089 | PostgreSQL | Eventos y calendario acadÃ©mico |
| **ms-teacher-assignment** | 9090 | PostgreSQL | AsignaciÃ³n de profesores |
| **ms-notification** | 9091 | MongoDB | Notificaciones (email, push, sms) |

### 5.2 Bounded Contexts (DDD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    BOUNDED CONTEXTS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           CORE DOMAIN (Dominios Principales)                     â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚   INSTITUTION   â”‚  â”‚    STUDENTS     â”‚  â”‚    ACADEMIC     â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚    CONTEXT      â”‚  â”‚    CONTEXT      â”‚  â”‚    CONTEXT      â”‚                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Institution   â”‚  â”‚ â€¢ Student       â”‚  â”‚ â€¢ Course        â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Classroom     â”‚  â”‚ â€¢ Guardian      â”‚  â”‚ â€¢ Competency    â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Schedule      â”‚  â”‚ â€¢ HealthInfo    â”‚  â”‚ â€¢ Capacity      â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ AcademicYear  â”‚  â”‚ â€¢ Development   â”‚  â”‚ â€¢ Performance   â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚   â”‚
â”‚  â”‚  â”‚   ENROLLMENT    â”‚  â”‚   ATTENDANCE    â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚    CONTEXT      â”‚  â”‚    CONTEXT      â”‚                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Enrollment    â”‚  â”‚ â€¢ Attendance    â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ AcademicPeriodâ”‚  â”‚ â€¢ Justification â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Document      â”‚  â”‚ â€¢ Summary       â”‚                                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        SUPPORTING DOMAIN (Dominios de Soporte)                   â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚     GRADES      â”‚  â”‚    BEHAVIOR     â”‚  â”‚   PSYCHOLOGY    â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚    CONTEXT      â”‚  â”‚    CONTEXT      â”‚  â”‚    CONTEXT      â”‚                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Evaluation    â”‚  â”‚ â€¢ BehaviorRecordâ”‚  â”‚ â€¢ Evaluation    â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ReportCard    â”‚  â”‚ â€¢ Incident      â”‚  â”‚ â€¢ SpecialNeeds  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Competency    â”‚  â”‚ â€¢ FollowUp      â”‚  â”‚ â€¢ Support       â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚   Evaluation    â”‚  â”‚                 â”‚  â”‚                 â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚   â”‚
â”‚  â”‚  â”‚     EVENTS      â”‚  â”‚    TEACHER      â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚    CONTEXT      â”‚  â”‚   ASSIGNMENT    â”‚                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Event         â”‚  â”‚ â€¢ Assignment    â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Calendar      â”‚  â”‚ â€¢ Schedule      â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ EventCalendar â”‚  â”‚ â€¢ Classroom     â”‚                                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          GENERIC DOMAIN (Dominios GenÃ©ricos)                     â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚   â”‚
â”‚  â”‚  â”‚     USERS       â”‚  â”‚  NOTIFICATION   â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚    CONTEXT      â”‚  â”‚    CONTEXT      â”‚                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ User          â”‚  â”‚ â€¢ Notification  â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Role          â”‚  â”‚ â€¢ Template      â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Permission    â”‚  â”‚ â€¢ Channel       â”‚                                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 Context Map - Relaciones entre Contextos

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   INSTITUTION   â”‚
                              â”‚    (Upstream)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                        â”‚                        â”‚
              â–¼                        â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     USERS       â”‚      â”‚    STUDENTS     â”‚      â”‚   ENROLLMENT    â”‚
    â”‚  (Conformist)   â”‚      â”‚  (Conformist)   â”‚      â”‚  (Conformist)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚                        â”‚
             â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
             â”‚         â”‚              â”‚              â”‚         â”‚
             â–¼         â–¼              â–¼              â–¼         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         ACADEMIC                                 â”‚
    â”‚                    (Shared Kernel)                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
    â–¼                 â–¼      â–¼                 â–¼      â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GRADES  â”‚  â”‚ATTENDANCEâ”‚  â”‚BEHAVIOR â”‚  â”‚PSYCHOLOGYâ”‚  â”‚ EVENTS  â”‚  â”‚ TEACHER â”‚
â”‚         â”‚  â”‚          â”‚  â”‚         â”‚  â”‚          â”‚  â”‚         â”‚  â”‚ ASSIGN  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚             â”‚            â”‚             â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  NOTIFICATION   â”‚
                              â”‚  (Anti-Corr.)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Leyenda:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
U = Upstream (proveedor de datos)
D = Downstream (consumidor de datos)
ACL = Anti-Corruption Layer
OHS = Open Host Service
PL = Published Language
```

---

## 6. Arquitectura Hexagonal + DDD

### 6.1 Capas de la Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ARQUITECTURA HEXAGONAL + DDD                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            INFRASTRUCTURE LAYER                                  â”‚   â”‚
â”‚  â”‚                         (Adaptadores Secundarios - Driven)                       â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Repository   â”‚  â”‚   Messaging   â”‚  â”‚  External     â”‚  â”‚    Cache      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Adapters     â”‚  â”‚   Adapters    â”‚  â”‚  Services     â”‚  â”‚   Adapters    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  (R2DBC/Mongo)â”‚  â”‚  (RabbitMQ)   â”‚  â”‚  (WebClient)  â”‚  â”‚   (Redis)     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                           â”‚                                             â”‚
â”‚                                           â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                              APPLICATION LAYER                                   â”‚   â”‚
â”‚  â”‚                           (Casos de Uso / Servicios)                             â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚                         PORTS (Interfaces)                             â”‚      â”‚   â”‚
â”‚  â”‚  â”‚                                                                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  â”‚     Input Ports         â”‚    â”‚     Output Ports        â”‚          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  (Use Case Interfaces)  â”‚    â”‚  (Repository Interfaces)â”‚          â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚                         USE CASES                                      â”‚      â”‚   â”‚
â”‚  â”‚  â”‚                                                                        â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  CreateStudentUseCase | UpdateStudentUseCase | EnrollStudentUseCase   â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  RegisterAttendanceUseCase | GenerateReportCardUseCase | ...          â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                           â”‚                                             â”‚
â”‚                                           â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                DOMAIN LAYER                                      â”‚   â”‚
â”‚  â”‚                              (NÃºcleo del Negocio)                                â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚    ENTITIES     â”‚  â”‚  VALUE OBJECTS  â”‚  â”‚   AGGREGATES    â”‚                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚   â”‚
â”‚  â”‚  â”‚ Student         â”‚  â”‚ StudentId       â”‚  â”‚ StudentAggregateâ”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ Institution     â”‚  â”‚ PersonalInfo    â”‚  â”‚ (Student +      â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ Enrollment      â”‚  â”‚ Address         â”‚  â”‚  Guardians +    â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ Attendance      â”‚  â”‚ HealthInfo      â”‚  â”‚  HealthInfo)    â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ DOMAIN EVENTS   â”‚  â”‚ DOMAIN SERVICES â”‚  â”‚  REPOSITORIES   â”‚                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   (Interfaces)  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ StudentCreated  â”‚  â”‚ EnrollmentPolicyâ”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚   â”‚
â”‚  â”‚  â”‚ StudentEnrolled â”‚  â”‚ AttendanceRules â”‚  â”‚ StudentRepo     â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ AttendanceMarkedâ”‚  â”‚ GradeCalculator â”‚  â”‚ EnrollmentRepo  â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                           â–²                                             â”‚
â”‚                                           â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            INFRASTRUCTURE LAYER                                  â”‚   â”‚
â”‚  â”‚                         (Adaptadores Primarios - Driving)                        â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚     REST      â”‚  â”‚   GraphQL     â”‚  â”‚     gRPC      â”‚  â”‚   Event       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Controllers  â”‚  â”‚   Resolvers   â”‚  â”‚   Services    â”‚  â”‚  Handlers     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Flujo de Dependencias

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                         â”‚
                    â”‚   Las dependencias SIEMPRE apuntan      â”‚
                    â”‚   hacia el CENTRO (Domain Layer)        â”‚
                    â”‚                                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              Infrastructure
                                    â”‚
                                    â–¼
                              Application
                                    â”‚
                                    â–¼
                                 Domain     â—€â”€â”€ El nÃºcleo NO depende de nada
                                    â–²
                                    â”‚
                              Application
                                    â–²
                                    â”‚
                              Infrastructure
```

---

## 7. API Gateway con Spring Cloud Gateway

### 7.1 ConfiguraciÃ³n del Gateway

```yaml
# application.yml del Gateway
server:
  port: 8080

spring:
  application:
    name: sigei-gateway

  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true

      default-filters:
        - name: RequestRateLimiter
          args:
            redis-rate-limiter:
              replenishRate: 100
              burstCapacity: 200
        - RemoveRequestHeader=Cookie
        - AddRequestHeader=X-Request-Source, gateway

      routes:
        # Instituciones
        - id: ms-institution
          uri: lb://MS-INSTITUTION
          predicates:
            - Path=/api/v1/institutions/**, /api/v1/classrooms/**
          filters:
            - name: CircuitBreaker
              args:
                name: institutionCircuitBreaker
                fallbackUri: forward:/fallback/institution

        # Usuarios
        - id: ms-users
          uri: lb://MS-USERS
          predicates:
            - Path=/api/v1/users/**
          filters:
            - name: CircuitBreaker
              args:
                name: usersCircuitBreaker

        # Estudiantes
        - id: ms-students
          uri: lb://MS-STUDENTS
          predicates:
            - Path=/api/v1/students/**

        # AcadÃ©mico
        - id: ms-academic
          uri: lb://MS-ACADEMIC
          predicates:
            - Path=/api/v1/courses/**, /api/v1/competencies/**, /api/v1/capacities/**

        # MatrÃ­culas
        - id: ms-enrollments
          uri: lb://MS-ENROLLMENTS
          predicates:
            - Path=/api/v1/enrollments/**, /api/v1/academic-periods/**

        # Asistencias
        - id: ms-attendance
          uri: lb://MS-ATTENDANCE
          predicates:
            - Path=/api/v1/attendance/**

        # Notas
        - id: ms-grades
          uri: lb://MS-GRADES
          predicates:
            - Path=/api/v1/grades/**, /api/v1/evaluations/**, /api/v1/report-cards/**

        # Comportamiento
        - id: ms-behavior
          uri: lb://MS-BEHAVIOR
          predicates:
            - Path=/api/v1/behavior/**, /api/v1/incidents/**

        # PsicologÃ­a
        - id: ms-psychology
          uri: lb://MS-PSYCHOLOGY
          predicates:
            - Path=/api/v1/psychology/**, /api/v1/special-needs/**

        # Eventos
        - id: ms-events
          uri: lb://MS-EVENTS
          predicates:
            - Path=/api/v1/events/**, /api/v1/calendars/**

        # AsignaciÃ³n de profesores
        - id: ms-teacher-assignment
          uri: lb://MS-TEACHER-ASSIGNMENT
          predicates:
            - Path=/api/v1/teacher-assignments/**

        # Notificaciones
        - id: ms-notification
          uri: lb://MS-NOTIFICATION
          predicates:
            - Path=/api/v1/notifications/**

  # Seguridad con OAuth2
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8180/realms/sigei}
          jwk-set-uri: ${KEYCLOAK_JWK_URI:http://localhost:8180/realms/sigei/protocol/openid-connect/certs}

# Eureka Client
eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_URI:http://localhost:8761/eureka}
  instance:
    prefer-ip-address: true

# Resilience4j
resilience4j:
  circuitbreaker:
    instances:
      default:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10000
        permitted-number-of-calls-in-half-open-state: 3

  timelimiter:
    instances:
      default:
        timeout-duration: 5s
```

### 7.2 Seguridad en Gateway

```java
@Configuration
@EnableWebFluxSecurity
public class GatewaySecurityConfig {

    @Bean
    public SecurityWebFilterChain securityWebFilterChain(ServerHttpSecurity http) {
        return http
            .csrf(csrf -> csrf.disable())
            .cors(cors -> cors.configurationSource(corsConfigurationSource()))
            .authorizeExchange(exchanges -> exchanges
                // Endpoints pÃºblicos
                .pathMatchers("/actuator/health", "/actuator/info").permitAll()
                .pathMatchers("/api/v1/auth/**").permitAll()
                .pathMatchers("/swagger-ui/**", "/v3/api-docs/**").permitAll()

                // Endpoints protegidos por rol
                .pathMatchers("/api/v1/institutions/**").hasAnyRole("ADMIN", "DIRECTOR")
                .pathMatchers("/api/v1/users/**").hasAnyRole("ADMIN", "DIRECTOR")
                .pathMatchers("/api/v1/students/**").hasAnyRole("ADMIN", "DIRECTOR", "PROFESOR", "AUXILIAR")
                .pathMatchers("/api/v1/attendance/**").hasAnyRole("ADMIN", "DIRECTOR", "PROFESOR", "AUXILIAR")
                .pathMatchers("/api/v1/grades/**").hasAnyRole("ADMIN", "DIRECTOR", "PROFESOR")

                // Por defecto, autenticado
                .anyExchange().authenticated()
            )
            .oauth2ResourceServer(oauth2 -> oauth2
                .jwt(jwt -> jwt.jwtAuthenticationConverter(jwtAuthConverter()))
            )
            .build();
    }

    @Bean
    public ReactiveJwtAuthenticationConverterAdapter jwtAuthConverter() {
        JwtGrantedAuthoritiesConverter grantedAuthoritiesConverter = new JwtGrantedAuthoritiesConverter();
        grantedAuthoritiesConverter.setAuthorityPrefix("ROLE_");
        grantedAuthoritiesConverter.setAuthoritiesClaimName("roles");

        JwtAuthenticationConverter jwtAuthConverter = new JwtAuthenticationConverter();
        jwtAuthConverter.setJwtGrantedAuthoritiesConverter(grantedAuthoritiesConverter);

        return new ReactiveJwtAuthenticationConverterAdapter(jwtAuthConverter);
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration config = new CorsConfiguration();
        config.setAllowedOrigins(List.of(
            "http://localhost:5173",
            "https://sigei.edu.pe"
        ));
        config.setAllowedMethods(List.of("GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"));
        config.setAllowedHeaders(List.of("*"));
        config.setAllowCredentials(true);
        config.setMaxAge(3600L);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        return source;
    }
}
```

---

## 8. Service Discovery con Eureka

### 8.1 Eureka Server

```yaml
# application.yml del Eureka Server
server:
  port: 8761

spring:
  application:
    name: sigei-eureka

eureka:
  instance:
    hostname: localhost
  client:
    register-with-eureka: false
    fetch-registry: false
    service-url:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/
  server:
    enable-self-preservation: false
    eviction-interval-timer-in-ms: 5000
```

### 8.2 Eureka Client (en cada microservicio)

```yaml
# ConfiguraciÃ³n cliente en cada microservicio
eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_URI:http://localhost:8761/eureka}
    fetch-registry: true
    register-with-eureka: true
  instance:
    prefer-ip-address: true
    lease-renewal-interval-in-seconds: 10
    lease-expiration-duration-in-seconds: 30
    metadata-map:
      version: ${APP_VERSION:1.0.0}
```

### 8.3 Diagrama de Registro

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    EUREKA SERVER                                         â”‚
â”‚                                    Puerto: 8761                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚   Registered Services:                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ Service Name          â”‚ Instance ID          â”‚ Status â”‚ IP:Port           â”‚      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚   â”‚ SIGEI-GATEWAY         â”‚ gateway:8080         â”‚   UP   â”‚ 192.168.1.10:8080 â”‚      â”‚
â”‚   â”‚ MS-INSTITUTION        â”‚ institution:9080     â”‚   UP   â”‚ 192.168.1.11:9080 â”‚      â”‚
â”‚   â”‚ MS-USERS              â”‚ users:9081           â”‚   UP   â”‚ 192.168.1.12:9081 â”‚      â”‚
â”‚   â”‚ MS-STUDENTS           â”‚ students:9082        â”‚   UP   â”‚ 192.168.1.13:9082 â”‚      â”‚
â”‚   â”‚ MS-ACADEMIC           â”‚ academic:9083        â”‚   UP   â”‚ 192.168.1.14:9083 â”‚      â”‚
â”‚   â”‚ MS-ENROLLMENTS        â”‚ enrollments:9084     â”‚   UP   â”‚ 192.168.1.15:9084 â”‚      â”‚
â”‚   â”‚ MS-ATTENDANCE         â”‚ attendance:9085      â”‚   UP   â”‚ 192.168.1.16:9085 â”‚      â”‚
â”‚   â”‚ MS-GRADES             â”‚ grades:9086          â”‚   UP   â”‚ 192.168.1.17:9086 â”‚      â”‚
â”‚   â”‚ MS-BEHAVIOR           â”‚ behavior:9087        â”‚   UP   â”‚ 192.168.1.18:9087 â”‚      â”‚
â”‚   â”‚ MS-PSYCHOLOGY         â”‚ psychology:9088      â”‚   UP   â”‚ 192.168.1.19:9088 â”‚      â”‚
â”‚   â”‚ MS-EVENTS             â”‚ events:9089          â”‚   UP   â”‚ 192.168.1.20:9089 â”‚      â”‚
â”‚   â”‚ MS-TEACHER-ASSIGNMENT â”‚ teacher:9090         â”‚   UP   â”‚ 192.168.1.21:9090 â”‚      â”‚
â”‚   â”‚ MS-NOTIFICATION       â”‚ notification:9091    â”‚   UP   â”‚ 192.168.1.22:9091 â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Seguridad con Keycloak

### 9.1 Â¿Por quÃ© Keycloak y no Firebase?

| CaracterÃ­stica | Keycloak | Firebase Auth |
|----------------|----------|---------------|
| **On-premise** | âœ… Self-hosted | âŒ Cloud only |
| **Multi-tenancy** | âœ… Realms nativos | âš ï¸ Limitado |
| **PersonalizaciÃ³n** | âœ… Total control | âŒ Limitado |
| **Roles granulares** | âœ… RBAC completo | âš ï¸ BÃ¡sico |
| **IntegraciÃ³n LDAP/AD** | âœ… Nativo | âŒ No |
| **SAML/OIDC** | âœ… Completo | âš ï¸ Solo OIDC |
| **Costo** | âœ… Open Source | âš ï¸ Pay-per-use |
| **SoberanÃ­a datos** | âœ… Datos en PerÃº | âŒ Servidores Google |
| **SLA educativo** | âœ… Configurable | âš ï¸ Depende plan |

**DecisiÃ³n**: **Keycloak** por control total, multi-tenancy nativo y cumplimiento de normativas peruanas de datos.

### 9.2 Arquitectura de Keycloak

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    KEYCLOAK                                              â”‚
â”‚                                 Puerto: 8180                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            REALM: sigei-master                                   â”‚   â”‚
â”‚  â”‚                    (AdministraciÃ³n del sistema)                                  â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  Roles: SUPER_ADMIN                                                              â”‚   â”‚
â”‚  â”‚  Usuarios: Administradores del sistema                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            REALM: sigei                                          â”‚   â”‚
â”‚  â”‚                    (Usuarios de instituciones)                                   â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                           ROLES                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚  â”‚  â”‚  ADMIN      â†’ Administrador de instituciÃ³n                                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  DIRECTOR   â†’ Director de instituciÃ³n                                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  PROFESOR   â†’ Docente                                                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  AUXILIAR   â†’ Personal de apoyo                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  PSICOLOGO  â†’ PsicÃ³logo escolar                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  PADRE      â†’ Padre de familia                                             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  MADRE      â†’ Madre de familia                                             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  TUTOR      â†’ Tutor legal                                                  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                      CUSTOM ATTRIBUTES                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚  â”‚  â”‚  institution_id  â†’ ID de la instituciÃ³n (tenant)                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  classroom_ids   â†’ IDs de aulas asignadas (profesores)                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  student_ids     â†’ IDs de estudiantes (padres)                            â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                          CLIENTS                                           â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚  â”‚  â”‚  sigei-web      â†’ SPA React (public client)                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  sigei-gateway  â†’ API Gateway (confidential client)                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  sigei-mobile   â†’ App mÃ³vil (public client)                               â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 Flujo de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario â”‚     â”‚  Frontend   â”‚     â”‚ Keycloak â”‚     â”‚   Gateway   â”‚     â”‚ Microserviceâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚  1. Login        â”‚                 â”‚                  â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚ 2. Redirect to  â”‚                  â”‚                   â”‚
     â”‚                  â”‚    /auth        â”‚                  â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚ 3. Auth Request  â”‚                 â”‚                  â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                 â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚ 4. Login Form    â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚ 5. Credentials   â”‚                 â”‚                  â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚ 6. Validate &    â”‚                   â”‚
     â”‚                  â”‚                 â”‚    Redirect with â”‚                   â”‚
     â”‚                  â”‚                 â”‚    Auth Code     â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚ 7. Exchange     â”‚                  â”‚                   â”‚
     â”‚                  â”‚    Auth Code    â”‚                  â”‚                   â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚ 8. Access Token â”‚                  â”‚                   â”‚
     â”‚                  â”‚    + Refresh    â”‚                  â”‚                   â”‚
     â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚ 9. API Call with Bearer Token      â”‚                   â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚ 10. Validate JWT  â”‚
     â”‚                  â”‚                 â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚ 11. Forward with  â”‚
     â”‚                  â”‚                 â”‚                  â”‚     Tenant ID     â”‚
     â”‚                  â”‚                 â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                  â”‚                 â”‚                  â”‚                   â”‚
     â”‚                  â”‚                 â”‚                  â”‚ 12. Response      â”‚
     â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚  13. Response    â”‚                 â”‚                  â”‚                   â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚                  â”‚                   â”‚
```

### 9.4 Estructura del JWT Token

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT",
    "kid": "keycloak-key-id"
  },
  "payload": {
    "exp": 1707580800,
    "iat": 1707577200,
    "jti": "unique-token-id",
    "iss": "http://localhost:8180/realms/sigei",
    "aud": "sigei-web",
    "sub": "user-uuid-12345",
    "typ": "Bearer",
    "azp": "sigei-web",

    // Claims personalizados para multi-tenancy
    "institution_id": "inst-uuid-001",
    "institution_name": "I.E.I. Los Jardines",
    "classroom_ids": ["classroom-001", "classroom-002"],
    "student_ids": ["student-001"],

    // Roles del usuario
    "realm_access": {
      "roles": ["PROFESOR", "default-roles-sigei"]
    },
    "resource_access": {
      "sigei-web": {
        "roles": ["access"]
      }
    },

    // Datos del usuario
    "preferred_username": "juan.perez",
    "email": "juan.perez@ejemplo.com",
    "given_name": "Juan",
    "family_name": "PÃ©rez",
    "name": "Juan PÃ©rez"
  }
}
```

### 9.5 Permisos por Rol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     MATRIZ DE PERMISOS                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚ Recurso        â”‚ SUPER_ADMINâ”‚  ADMIN   â”‚ DIRECTOR â”‚ PROFESOR â”‚ AUXILIAR â”‚ PSICOLOGO â”‚  PADRE/   â”‚TUTOR â”‚
â”‚                â”‚            â”‚          â”‚          â”‚          â”‚          â”‚           â”‚  MADRE    â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ Institutions   â”‚   CRUD     â”‚   CRUD   â”‚    R     â”‚    R     â”‚    R     â”‚     R     â”‚     R     â”‚  R   â”‚
â”‚ Users          â”‚   CRUD     â”‚   CRUD   â”‚   CRU    â”‚    R     â”‚    R     â”‚     R     â”‚     -     â”‚  -   â”‚
â”‚ Classrooms     â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚    R     â”‚    R     â”‚     R     â”‚     R     â”‚  R   â”‚
â”‚ Students       â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚    RU    â”‚    R     â”‚    RU     â”‚    R*     â”‚ R*   â”‚
â”‚ Enrollments    â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚    R     â”‚    R     â”‚     R     â”‚    R*     â”‚ R*   â”‚
â”‚ Attendance     â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚   CRUD   â”‚   CRU    â”‚     R     â”‚    R*     â”‚ R*   â”‚
â”‚ Grades         â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚   CRUD   â”‚    R     â”‚     R     â”‚    R*     â”‚ R*   â”‚
â”‚ Behavior       â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚   CRU    â”‚   CRU    â”‚    CRU    â”‚    R*     â”‚ R*   â”‚
â”‚ Psychology     â”‚   CRUD     â”‚   CRUD   â”‚   CRU    â”‚    R     â”‚    R     â”‚   CRUD    â”‚    R*     â”‚ R*   â”‚
â”‚ Events         â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚    R     â”‚    R     â”‚     R     â”‚     R     â”‚  R   â”‚
â”‚ TeacherAssign  â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚    R     â”‚    -     â”‚     -     â”‚     -     â”‚  -   â”‚
â”‚ Notifications  â”‚   CRUD     â”‚   CRUD   â”‚   CRUD   â”‚    RU    â”‚    R     â”‚    RU     â”‚    RU     â”‚ RU   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¤
â”‚ Leyenda: C=Create, R=Read, U=Update, D=Delete, R*=Solo sus estudiantes/hijos                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Event-Driven Architecture con RabbitMQ

### 10.1 RabbitMQ como Message Broker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   RABBITMQ                                               â”‚
â”‚                              Message Broker - Puerto: 5672                               â”‚
â”‚                              Admin UI - Puerto: 15672                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           EXCHANGES (Topic)                                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ sigei.institution       â”‚     â”‚ sigei.student           â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ (Topic Exchange)        â”‚     â”‚ (Topic Exchange)        â”‚                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚   â”‚
â”‚  â”‚  â”‚ Routing Keys:           â”‚     â”‚ Routing Keys:           â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ institution.created   â”‚     â”‚ â€¢ student.created       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ institution.updated   â”‚     â”‚ â€¢ student.enrolled      â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ classroom.created     â”‚     â”‚ â€¢ student.transferred   â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ sigei.attendance        â”‚     â”‚ sigei.notification      â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ (Topic Exchange)        â”‚     â”‚ (Direct Exchange)       â”‚                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚   â”‚
â”‚  â”‚  â”‚ Routing Keys:           â”‚     â”‚ Routing Keys:           â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ attendance.marked     â”‚     â”‚ â€¢ email                 â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ attendance.absent     â”‚     â”‚ â€¢ push                  â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ attendance.justified  â”‚     â”‚ â€¢ sms                   â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ attendance.report     â”‚     â”‚ â€¢ whatsapp              â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚   â”‚
â”‚  â”‚  â”‚ sigei.document          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ (Topic Exchange)        â”‚     â”‚  DEAD LETTER EXCHANGE   â”‚                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚  sigei.dlx              â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ Routing Keys:           â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ document.uploaded     â”‚     â”‚ Mensajes fallidos van   â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ document.shared       â”‚     â”‚ aquÃ­ para retry o       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ report.generated      â”‚     â”‚ anÃ¡lisis manual         â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                              QUEUES                                              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  notification.email.queue â”€â”€â”€â”€â”€â–º ms-notification (Email Worker)                 â”‚   â”‚
â”‚  â”‚  notification.push.queue â”€â”€â”€â”€â”€â”€â–º ms-notification (Push Worker)                  â”‚   â”‚
â”‚  â”‚  notification.sms.queue â”€â”€â”€â”€â”€â”€â”€â–º ms-notification (SMS Worker)                   â”‚   â”‚
â”‚  â”‚  notification.whatsapp.queue â”€â”€â–º ms-notification (WhatsApp Worker)              â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  attendance.absent.queue â”€â”€â”€â”€â”€â”€â–º ms-notification (Alertas de ausencia)          â”‚   â”‚
â”‚  â”‚  document.share.queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ms-notification (EnvÃ­o de documentos)          â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  dlx.retry.queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Reintentos automÃ¡ticos                         â”‚   â”‚
â”‚  â”‚  dlx.failed.queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º RevisiÃ³n manual                                â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ConfiguraciÃ³n de RabbitMQ

```yaml
# application.yml
spring:
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USER:sigei}
    password: ${RABBITMQ_PASSWORD:sigei_dev}
    virtual-host: /sigei

    # ConfiguraciÃ³n de listeners
    listener:
      simple:
        acknowledge-mode: manual  # ACK manual para control
        prefetch: 10              # Mensajes por consumer
        retry:
          enabled: true
          initial-interval: 1000
          max-attempts: 3
          multiplier: 2.0

    # Publisher confirms
    publisher-confirm-type: correlated
    publisher-returns: true
```

### 10.3 ConfiguraciÃ³n de Exchanges y Queues

```java
@Configuration
public class RabbitMQConfig {

    // ========== EXCHANGES ==========

    @Bean
    public TopicExchange attendanceExchange() {
        return new TopicExchange("sigei.attendance");
    }

    @Bean
    public TopicExchange studentExchange() {
        return new TopicExchange("sigei.student");
    }

    @Bean
    public TopicExchange documentExchange() {
        return new TopicExchange("sigei.document");
    }

    @Bean
    public DirectExchange notificationExchange() {
        return new DirectExchange("sigei.notification");
    }

    @Bean
    public DirectExchange deadLetterExchange() {
        return new DirectExchange("sigei.dlx");
    }

    // ========== QUEUES ==========

    @Bean
    public Queue emailQueue() {
        return QueueBuilder.durable("notification.email.queue")
            .withArgument("x-dead-letter-exchange", "sigei.dlx")
            .withArgument("x-dead-letter-routing-key", "dlx.email")
            .build();
    }

    @Bean
    public Queue pushQueue() {
        return QueueBuilder.durable("notification.push.queue")
            .withArgument("x-dead-letter-exchange", "sigei.dlx")
            .build();
    }

    @Bean
    public Queue smsQueue() {
        return QueueBuilder.durable("notification.sms.queue")
            .withArgument("x-dead-letter-exchange", "sigei.dlx")
            .build();
    }

    @Bean
    public Queue whatsappQueue() {
        return QueueBuilder.durable("notification.whatsapp.queue")
            .withArgument("x-dead-letter-exchange", "sigei.dlx")
            .build();
    }

    @Bean
    public Queue attendanceAbsentQueue() {
        return QueueBuilder.durable("attendance.absent.queue").build();
    }

    @Bean
    public Queue documentShareQueue() {
        return QueueBuilder.durable("document.share.queue").build();
    }

    // ========== BINDINGS ==========

    @Bean
    public Binding emailBinding() {
        return BindingBuilder.bind(emailQueue())
            .to(notificationExchange())
            .with("email");
    }

    @Bean
    public Binding attendanceAbsentBinding() {
        return BindingBuilder.bind(attendanceAbsentQueue())
            .to(attendanceExchange())
            .with("attendance.absent");
    }

    @Bean
    public Binding documentShareBinding() {
        return BindingBuilder.bind(documentShareQueue())
            .to(documentExchange())
            .with("document.shared");
    }
}
```

### 10.4 Publisher de Mensajes

```java
@Component
@RequiredArgsConstructor
@Slf4j
public class RabbitMQPublisher {

    private final RabbitTemplate rabbitTemplate;

    public void publishAttendanceEvent(AttendanceEvent event) {
        String routingKey = "attendance." + event.getStatus().toLowerCase();

        rabbitTemplate.convertAndSend(
            "sigei.attendance",
            routingKey,
            event,
            message -> {
                message.getMessageProperties().setHeader("tenant_id", event.getTenantId());
                message.getMessageProperties().setHeader("timestamp", Instant.now().toString());
                return message;
            }
        );

        log.info("Published attendance event: {} for student: {}",
            routingKey, event.getStudentId());
    }

    public void sendNotification(NotificationCommand command) {
        rabbitTemplate.convertAndSend(
            "sigei.notification",
            command.getChannel().toLowerCase(),  // email, push, sms, whatsapp
            command
        );

        log.info("Notification queued: {} to {}",
            command.getChannel(), command.getRecipient());
    }

    public void publishDocumentShared(DocumentSharedEvent event) {
        rabbitTemplate.convertAndSend(
            "sigei.document",
            "document.shared",
            event
        );
    }
}
```

### 10.5 Consumer de Mensajes

```java
@Component
@RequiredArgsConstructor
@Slf4j
public class AttendanceEventConsumer {

    private final NotificationService notificationService;
    private final ParentNotificationService parentNotificationService;

    @RabbitListener(queues = "attendance.absent.queue")
    public void handleAbsentStudent(
            AttendanceEvent event,
            Channel channel,
            @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {

        try {
            log.info("Processing absent notification for student: {}", event.getStudentId());

            // Notificar a los padres sobre la ausencia
            parentNotificationService.notifyAbsence(
                event.getTenantId(),
                event.getStudentId(),
                event.getDate()
            );

            // ACK manual
            channel.basicAck(deliveryTag, false);

        } catch (Exception e) {
            log.error("Error processing absent notification", e);
            // NACK - irÃ¡ al Dead Letter Queue
            channel.basicNack(deliveryTag, false, false);
        }
    }
}

@Component
@RequiredArgsConstructor
@Slf4j
public class DocumentEventConsumer {

    private final ParentNotificationService parentNotificationService;

    @RabbitListener(queues = "document.share.queue")
    public void handleDocumentShared(
            DocumentSharedEvent event,
            Channel channel,
            @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {

        try {
            // Enviar documento a los padres
            parentNotificationService.sendDocument(
                event.getTenantId(),
                event.getStudentId(),
                event.getDocumentType(),
                event.getDocumentUrl(),
                event.getMessage()
            );

            channel.basicAck(deliveryTag, false);

        } catch (Exception e) {
            log.error("Error sending document to parent", e);
            channel.basicNack(deliveryTag, false, false);
        }
    }
}
```

### 10.6 Flujo de NotificaciÃ³n a Padres

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO: NOTIFICACIÃ“N DE AUSENCIA A PADRES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Profesor  â”‚   â”‚ Attendance â”‚   â”‚  RabbitMQ  â”‚   â”‚Notificationâ”‚   â”‚   Padre    â”‚   â”‚
â”‚  â”‚            â”‚   â”‚  Service   â”‚   â”‚            â”‚   â”‚  Service   â”‚   â”‚            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚ 1. Marca       â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚    AUSENTE     â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚ 2. Guardar     â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚    en BD       â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚ 3. Publish     â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚ attendance.    â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚ absent         â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚  4. Response   â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚ 5. Consume     â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚    message     â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚ 6. Obtener     â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚    datos del   â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚    estudiante  â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚    y padres    â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚ 7. Enviar      â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚    Push/Email  â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚    /WhatsApp   â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚          â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚ ğŸ“± Notif â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚ "Su hijo â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚ Juan no  â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                â”‚ asistiÃ³" â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Estructura de Carpetas Estandarizada

### 11.1 Estructura de Proyecto

```
sigei-microservices/
â”œâ”€â”€ ğŸ“ infrastructure/
â”‚   â”œâ”€â”€ ğŸ“ docker/
â”‚   â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”‚   â”œâ”€â”€ docker-compose.dev.yml
â”‚   â”‚   â””â”€â”€ docker-compose.prod.yml
â”‚   â”œâ”€â”€ ğŸ“ nginx/
â”‚   â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”‚   â””â”€â”€ ğŸ“ ssl/
â”‚   â”œâ”€â”€ ğŸ“ keycloak/
â”‚   â”‚   â””â”€â”€ realm-sigei.json
â”‚   â”œâ”€â”€ ğŸ“ sql/
â”‚   â”‚   â””â”€â”€ init.sql
â”‚   â””â”€â”€ ğŸ“ scripts/
â”‚       â”œâ”€â”€ deploy.sh
â”‚       â”œâ”€â”€ backup.sh
â”‚       â”œâ”€â”€ setup-local.sh
â”‚       â””â”€â”€ init-keycloak.sh
â”‚
â”œâ”€â”€ ğŸ“ services/
â”‚   â”œâ”€â”€ ğŸ“ sigei-eureka/               # Service Discovery
â”‚   â”œâ”€â”€ ğŸ“ sigei-config/               # Config Server
â”‚   â”œâ”€â”€ ğŸ“ sigei-gateway/              # API Gateway
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ ms-institution/             # Microservicio de Instituciones
â”‚   â”œâ”€â”€ ğŸ“ ms-users/                   # Microservicio de Usuarios
â”‚   â”œâ”€â”€ ğŸ“ ms-students/                # Microservicio de Estudiantes
â”‚   â”œâ”€â”€ ğŸ“ ms-academic/                # Microservicio AcadÃ©mico
â”‚   â”œâ”€â”€ ğŸ“ ms-enrollments/             # Microservicio de MatrÃ­culas
â”‚   â”œâ”€â”€ ğŸ“ ms-attendance/              # Microservicio de Asistencias
â”‚   â”œâ”€â”€ ğŸ“ ms-grades/                  # Microservicio de Notas
â”‚   â”œâ”€â”€ ğŸ“ ms-behavior/                # Microservicio de Comportamiento
â”‚   â”œâ”€â”€ ğŸ“ ms-psychology/              # Microservicio de PsicologÃ­a
â”‚   â”œâ”€â”€ ğŸ“ ms-events/                  # Microservicio de Eventos
â”‚   â”œâ”€â”€ ğŸ“ ms-teacher-assignment/      # Microservicio de AsignaciÃ³n Docente
â”‚   â””â”€â”€ ğŸ“ ms-notification/            # Microservicio de Notificaciones
â”‚
â”œâ”€â”€ ğŸ“ shared/
â”‚   â”œâ”€â”€ ğŸ“ sigei-common/               # LibrerÃ­a comÃºn
â”‚   â”œâ”€â”€ ğŸ“ sigei-events/               # DefiniciÃ³n de eventos
â”‚   â””â”€â”€ ğŸ“ sigei-security/             # ConfiguraciÃ³n de seguridad
â”‚
â””â”€â”€ ğŸ“ frontend/
    â””â”€â”€ ğŸ“ sigei-web/                  # AplicaciÃ³n React
```

### 11.2 Estructura de un Microservicio (Arquitectura Hexagonal + DDD)

```
ms-students/
â”œâ”€â”€ ğŸ“„ pom.xml
â”œâ”€â”€ ğŸ“„ Dockerfile
â”œâ”€â”€ ğŸ“„ README.md
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ main/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ java/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ pe/edu/vallegrande/students/
â”‚   â”‚   â”‚       â”‚
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ MsStudentsApplication.java
â”‚   â”‚   â”‚       â”‚
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“ domain/                          # ğŸŸ¢ CAPA DE DOMINIO
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ model/                       # Entidades y Value Objects
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Student.java             # Aggregate Root
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentId.java           # Value Object (ID tipado)
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“ vo/                      # Value Objects
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PersonalInfo.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Guardian.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ HealthInfo.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DevelopmentInfo.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ Address.java
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“ enums/
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ğŸ“„ StudentStatus.java
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ğŸ“„ Gender.java
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ğŸ“„ DocumentType.java
â”‚   â”‚   â”‚       â”‚   â”‚       â””â”€â”€ ğŸ“„ GuardianRole.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ event/                       # Eventos de Dominio
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentCreatedEvent.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentEnrolledEvent.java
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ StudentTransferredEvent.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ exception/                   # Excepciones de Dominio
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentNotFoundException.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DuplicateDocumentException.java
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ InvalidGuardianException.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ repository/                  # Interfaces de Repositorio (Puertos)
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ StudentRepository.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“ service/                     # Servicios de Dominio
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ ğŸ“„ StudentDomainService.java
â”‚   â”‚   â”‚       â”‚
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“ application/                     # ğŸŸ¡ CAPA DE APLICACIÃ“N
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ port/                        # Puertos (Interfaces)
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“ input/                   # Puertos de Entrada (Casos de Uso)
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateStudentUseCase.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateStudentUseCase.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetStudentUseCase.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ DeleteStudentUseCase.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“ output/                  # Puertos de Salida
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ğŸ“„ StudentPersistencePort.java
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ğŸ“„ StudentEventPublisherPort.java
â”‚   â”‚   â”‚       â”‚   â”‚       â””â”€â”€ ğŸ“„ UserServicePort.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ service/                     # ImplementaciÃ³n de Casos de Uso
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateStudentService.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateStudentService.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetStudentService.java
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ DeleteStudentService.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“ dto/                         # DTOs de AplicaciÃ³n
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“ command/                 # Comandos (Input)
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateStudentCommand.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ UpdateStudentCommand.java
â”‚   â”‚   â”‚       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“ query/                   # Queries (Output)
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ğŸ“„ StudentResponse.java
â”‚   â”‚   â”‚       â”‚   â”‚       â””â”€â”€ ğŸ“„ StudentListResponse.java
â”‚   â”‚   â”‚       â”‚   â”‚
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“ mapper/                      # Mappers
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ ğŸ“„ StudentApplicationMapper.java
â”‚   â”‚   â”‚       â”‚
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“ infrastructure/                  # ğŸ”µ CAPA DE INFRAESTRUCTURA
â”‚   â”‚   â”‚           â”‚
â”‚   â”‚   â”‚           â”œâ”€â”€ ğŸ“ adapter/
â”‚   â”‚   â”‚           â”‚   â”‚
â”‚   â”‚   â”‚           â”‚   â”œâ”€â”€ ğŸ“ input/                   # Adaptadores de Entrada (Driving)
â”‚   â”‚   â”‚           â”‚   â”‚   â”œâ”€â”€ ğŸ“ rest/                # API REST
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentController.java
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentExceptionHandler.java
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ request/         # DTOs de Request
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateStudentRequest.java
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ UpdateStudentRequest.java
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ response/        # DTOs de Response
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ StudentRestResponse.java
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ ApiResponse.java
â”‚   â”‚   â”‚           â”‚   â”‚   â”‚
â”‚   â”‚   â”‚           â”‚   â”‚   â””â”€â”€ ğŸ“ event/               # Consumidor de Eventos
â”‚   â”‚   â”‚           â”‚   â”‚       â””â”€â”€ ğŸ“„ UserEventHandler.java
â”‚   â”‚   â”‚           â”‚   â”‚
â”‚   â”‚   â”‚           â”‚   â””â”€â”€ ğŸ“ output/                  # Adaptadores de Salida (Driven)
â”‚   â”‚   â”‚           â”‚       â”œâ”€â”€ ğŸ“ persistence/         # Persistencia
â”‚   â”‚   â”‚           â”‚       â”‚   â”œâ”€â”€ ğŸ“ mongodb/
â”‚   â”‚   â”‚           â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentMongoRepository.java
â”‚   â”‚   â”‚           â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ StudentDocument.java
â”‚   â”‚   â”‚           â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ StudentPersistenceAdapter.java
â”‚   â”‚   â”‚           â”‚       â”‚   â””â”€â”€ ğŸ“„ StudentPersistenceMapper.java
â”‚   â”‚   â”‚           â”‚       â”‚
â”‚   â”‚   â”‚           â”‚       â”œâ”€â”€ ğŸ“ messaging/           # MensajerÃ­a
â”‚   â”‚   â”‚           â”‚       â”‚   â””â”€â”€ ğŸ“„ StudentRabbitPublisher.java
â”‚   â”‚   â”‚           â”‚       â”‚
â”‚   â”‚   â”‚           â”‚       â””â”€â”€ ğŸ“ client/              # Clientes HTTP
â”‚   â”‚   â”‚           â”‚           â”œâ”€â”€ ğŸ“„ UserServiceClient.java
â”‚   â”‚   â”‚           â”‚           â”œâ”€â”€ ğŸ“„ InstitutionServiceClient.java
â”‚   â”‚   â”‚           â”‚           â””â”€â”€ ğŸ“ dto/
â”‚   â”‚   â”‚           â”‚               â”œâ”€â”€ ğŸ“„ UserClientResponse.java
â”‚   â”‚   â”‚           â”‚               â””â”€â”€ ğŸ“„ InstitutionClientResponse.java
â”‚   â”‚   â”‚           â”‚
â”‚   â”‚   â”‚           â””â”€â”€ ğŸ“ config/                      # Configuraciones
â”‚   â”‚   â”‚               â”œâ”€â”€ ğŸ“„ SecurityConfig.java
â”‚   â”‚   â”‚               â”œâ”€â”€ ğŸ“„ WebClientConfig.java
â”‚   â”‚   â”‚               â”œâ”€â”€ ğŸ“„ RabbitMQConfig.java
â”‚   â”‚   â”‚               â”œâ”€â”€ ğŸ“„ MongoConfig.java
â”‚   â”‚   â”‚               â”œâ”€â”€ ğŸ“„ OpenApiConfig.java
â”‚   â”‚   â”‚               â””â”€â”€ ğŸ“„ TenantConfig.java
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ resources/
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ application.yml
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ application-dev.yml
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ application-prod.yml
â”‚   â”‚       â””â”€â”€ ğŸ“„ bootstrap.yml
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ test/
â”‚       â””â”€â”€ ğŸ“ java/
â”‚           â””â”€â”€ ğŸ“ pe/edu/vallegrande/students/
â”‚               â”œâ”€â”€ ğŸ“ domain/
â”‚               â”‚   â”œâ”€â”€ ğŸ“„ StudentTest.java
â”‚               â”‚   â””â”€â”€ ğŸ“„ StudentDomainServiceTest.java
â”‚               â”œâ”€â”€ ğŸ“ application/
â”‚               â”‚   â””â”€â”€ ğŸ“„ CreateStudentServiceTest.java
â”‚               â””â”€â”€ ğŸ“ infrastructure/
â”‚                   â”œâ”€â”€ ğŸ“ rest/
â”‚                   â”‚   â””â”€â”€ ğŸ“„ StudentControllerTest.java
â”‚                   â””â”€â”€ ğŸ“ persistence/
â”‚                       â””â”€â”€ ğŸ“„ StudentPersistenceAdapterTest.java
```

### 11.3 Convenciones de Nomenclatura

| Elemento | PatrÃ³n | Ejemplo |
|----------|--------|---------|
| **Paquete base** | `pe.edu.vallegrande.{contexto}` | `pe.edu.vallegrande.students` |
| **Entidad** | `{Nombre}` (singular) | `Student`, `Institution` |
| **Value Object** | `{Nombre}` (descriptivo) | `PersonalInfo`, `Address` |
| **Evento de dominio** | `{Entidad}{AcciÃ³n}Event` | `StudentCreatedEvent` |
| **ExcepciÃ³n** | `{DescripciÃ³n}Exception` | `StudentNotFoundException` |
| **Caso de uso** | `{AcciÃ³n}{Entidad}UseCase` | `CreateStudentUseCase` |
| **Servicio de aplicaciÃ³n** | `{AcciÃ³n}{Entidad}Service` | `CreateStudentService` |
| **Comando** | `{AcciÃ³n}{Entidad}Command` | `CreateStudentCommand` |
| **Controller REST** | `{Entidad}Controller` | `StudentController` |
| **Request DTO** | `{AcciÃ³n}{Entidad}Request` | `CreateStudentRequest` |
| **Response DTO** | `{Entidad}Response` | `StudentResponse` |
| **Repository port** | `{Entidad}PersistencePort` | `StudentPersistencePort` |
| **Repository adapter** | `{Entidad}PersistenceAdapter` | `StudentPersistenceAdapter` |
| **Client** | `{Servicio}ServiceClient` | `UserServiceClient` |

---

## 12. ConfiguraciÃ³n Centralizada

### 12.1 Spring Cloud Config Server

```yaml
# sigei-config/application.yml
server:
  port: 8888

spring:
  application:
    name: sigei-config

  cloud:
    config:
      server:
        git:
          uri: ${CONFIG_REPO_URI:https://github.com/sigei/config-repo}
          default-label: main
          search-paths: '{application}'
          clone-on-start: true

        # Para desarrollo local
        native:
          search-locations: classpath:/config

  profiles:
    active: native  # Cambiar a 'git' en producciÃ³n

# Eureka
eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_URI:http://localhost:8761/eureka}
```

### 12.2 Estructura del Repositorio de ConfiguraciÃ³n

```
config-repo/
â”œâ”€â”€ ğŸ“ application/                    # ConfiguraciÃ³n compartida
â”‚   â”œâ”€â”€ ğŸ“„ application.yml             # Base para todos
â”‚   â”œâ”€â”€ ğŸ“„ application-dev.yml
â”‚   â””â”€â”€ ğŸ“„ application-prod.yml
â”‚
â”œâ”€â”€ ğŸ“ ms-institution/
â”‚   â”œâ”€â”€ ğŸ“„ ms-institution.yml
â”‚   â”œâ”€â”€ ğŸ“„ ms-institution-dev.yml
â”‚   â””â”€â”€ ğŸ“„ ms-institution-prod.yml
â”‚
â”œâ”€â”€ ğŸ“ ms-students/
â”‚   â”œâ”€â”€ ğŸ“„ ms-students.yml
â”‚   â”œâ”€â”€ ğŸ“„ ms-students-dev.yml
â”‚   â””â”€â”€ ğŸ“„ ms-students-prod.yml
â”‚
â””â”€â”€ ... (demÃ¡s microservicios)
```

### 12.3 ConfiguraciÃ³n Base Compartida

```yaml
# application.yml (compartido)
spring:
  # Seguridad OAuth2
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI}
          jwk-set-uri: ${KEYCLOAK_JWK_URI}

# Eureka Client
eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_URI:http://localhost:8761/eureka}
  instance:
    prefer-ip-address: true

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  health:
    circuitbreakers:
      enabled: true

# Logging
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  level:
    pe.edu.vallegrande: DEBUG
    org.springframework.security: DEBUG

# OpenAPI/Swagger
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
```

### 12.4 Variables de Entorno Requeridas

```bash
# Base de datos
DATABASE_URL=r2dbc:postgresql://localhost:5432/sigei
DATABASE_USER=sigei_user
DATABASE_PASSWORD=secure_password

# MongoDB
MONGODB_URI=mongodb://localhost:27017/sigei

# Keycloak
KEYCLOAK_ISSUER_URI=http://localhost:8180/realms/sigei
KEYCLOAK_JWK_URI=http://localhost:8180/realms/sigei/protocol/openid-connect/certs

# RabbitMQ
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=sigei
RABBITMQ_PASSWORD=sigei_dev
RABBITMQ_VHOST=/sigei

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# Eureka
EUREKA_URI=http://localhost:8761/eureka

# Config Server
CONFIG_SERVER_URI=http://localhost:8888
```

---

## 13. Observabilidad

### 13.1 Stack de Observabilidad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   OBSERVABILIDAD                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                              LOGS                                                â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚Microserviceâ”‚â”€â”€â”€â–¶â”‚  Fluentd   â”‚â”€â”€â”€â–¶â”‚Elasticsearchâ”‚â”€â”€â–¶â”‚  Kibana    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   Logs     â”‚    â”‚  Collector â”‚    â”‚   Storage  â”‚    â”‚ Dashboard  â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                              METRICS                                             â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚
â”‚  â”‚  â”‚Microserviceâ”‚â”€â”€â”€â–¶â”‚ Prometheus â”‚â”€â”€â”€â–¶â”‚  Grafana   â”‚                             â”‚   â”‚
â”‚  â”‚  â”‚  /actuator â”‚    â”‚   Scrape   â”‚    â”‚ Dashboards â”‚                             â”‚   â”‚
â”‚  â”‚  â”‚  /metrics  â”‚    â”‚            â”‚    â”‚            â”‚                             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                              TRACING                                             â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚
â”‚  â”‚  â”‚Microserviceâ”‚â”€â”€â”€â–¶â”‚   Zipkin   â”‚â”€â”€â”€â–¶â”‚   Jaeger   â”‚                             â”‚   â”‚
â”‚  â”‚  â”‚   Traces   â”‚    â”‚  Collector â”‚    â”‚     UI     â”‚                             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 ConfiguraciÃ³n de Micrometer

```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  metrics:
    distribution:
      percentiles-histogram:
        http.server.requests: true
    tags:
      application: ${spring.application.name}
  tracing:
    sampling:
      probability: 1.0

# Prometheus
spring:
  cloud:
    discovery:
      client:
        health-indicator:
          enabled: true
```

---

## 14. Despliegue en VPC (Docker Compose)

### 14.1 Infraestructura de Despliegue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VPC: lab.vallegrande.edu.pe                                     â”‚
â”‚                              Despliegue con Docker Compose                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         SERVIDOR PRINCIPAL                                       â”‚   â”‚
â”‚  â”‚                    (Docker Host - Ubuntu 22.04 LTS)                              â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                    CONTENEDORES DE INFRAESTRUCTURA                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ PostgreSQL â”‚ â”‚  MongoDB   â”‚ â”‚   Redis    â”‚ â”‚  RabbitMQ  â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   :5432    â”‚ â”‚   :27017   â”‚ â”‚   :6379    â”‚ â”‚:5672/:15672â”‚            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Keycloak  â”‚ â”‚   Nginx    â”‚                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   :8180    â”‚ â”‚  (Proxy)   â”‚                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚            â”‚ â”‚   :80/443  â”‚                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                    CONTENEDORES DE SPRING CLOUD                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   Eureka   â”‚ â”‚   Config   â”‚ â”‚  Gateway   â”‚                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   :8761    â”‚ â”‚   :8888    â”‚ â”‚   :8080    â”‚                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                    CONTENEDORES DE NEGOCIO                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  ms-institution:9080  ms-users:9081       ms-students:9082              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  ms-academic:9083     ms-enrollments:9084 ms-attendance:9085            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  ms-grades:9086       ms-behavior:9087    ms-psychology:9088            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  ms-events:9089       ms-teacher:9090     ms-notification:9091          â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 14.2 Docker Compose - Desarrollo Local

```yaml
# docker-compose.yml
version: '3.8'

services:
  # ============================================================
  # INFRAESTRUCTURA
  # ============================================================

  postgres:
    image: postgres:16-alpine
    container_name: sigei-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: sigei
      POSTGRES_PASSWORD: ${DB_PASSWORD:-sigei_dev}
      POSTGRES_DB: sigei
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/sql/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U sigei"]
      interval: 10s
      timeout: 5s
      retries: 5

  mongodb:
    image: mongo:7.0
    container_name: sigei-mongodb
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: sigei
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD:-sigei_dev}
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: sigei-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  rabbitmq:
    image: rabbitmq:3.13-management-alpine
    container_name: sigei-rabbitmq
    restart: unless-stopped
    environment:
      RABBITMQ_DEFAULT_USER: sigei
      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASSWORD:-sigei_dev}
      RABBITMQ_DEFAULT_VHOST: /sigei
    ports:
      - "5672:5672"   # AMQP
      - "15672:15672" # Management UI
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "-q", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  keycloak:
    image: quay.io/keycloak/keycloak:24.0.0
    container_name: sigei-keycloak
    restart: unless-stopped
    command: start-dev --import-realm
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: ${KEYCLOAK_PASSWORD:-admin}
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://postgres:5432/keycloak
      KC_DB_USERNAME: sigei
      KC_DB_PASSWORD: ${DB_PASSWORD:-sigei_dev}
    ports:
      - "8180:8080"
    volumes:
      - ./infrastructure/keycloak/realm-sigei.json:/opt/keycloak/data/import/realm-sigei.json
    depends_on:
      postgres:
        condition: service_healthy

  # ============================================================
  # SPRING CLOUD INFRASTRUCTURE
  # ============================================================

  eureka:
    build: ./services/sigei-eureka
    container_name: sigei-eureka
    restart: unless-stopped
    ports:
      - "8761:8761"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 5

  config:
    build: ./services/sigei-config
    container_name: sigei-config
    restart: unless-stopped
    ports:
      - "8888:8888"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
    depends_on:
      eureka:
        condition: service_healthy

  gateway:
    build: ./services/sigei-gateway
    container_name: sigei-gateway
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - KEYCLOAK_ISSUER_URI=http://keycloak:8080/realms/sigei
    depends_on:
      - eureka
      - keycloak

  # ============================================================
  # MICROSERVICIOS DE NEGOCIO
  # ============================================================

  ms-institution:
    build: ./services/ms-institution
    container_name: sigei-institution
    restart: unless-stopped
    ports:
      - "9080:9080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - MONGODB_URI=mongodb://sigei:${MONGO_PASSWORD:-sigei_dev}@mongodb:27017/sigei?authSource=admin
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - mongodb
      - rabbitmq

  ms-users:
    build: ./services/ms-users
    container_name: sigei-users
    restart: unless-stopped
    ports:
      - "9081:9081"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - MONGODB_URI=mongodb://sigei:${MONGO_PASSWORD:-sigei_dev}@mongodb:27017/sigei?authSource=admin
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - mongodb
      - rabbitmq

  ms-students:
    build: ./services/ms-students
    container_name: sigei-students
    restart: unless-stopped
    ports:
      - "9082:9082"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - MONGODB_URI=mongodb://sigei:${MONGO_PASSWORD:-sigei_dev}@mongodb:27017/sigei?authSource=admin
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - mongodb
      - rabbitmq

  ms-academic:
    build: ./services/ms-academic
    container_name: sigei-academic
    restart: unless-stopped
    ports:
      - "9083:9083"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-enrollments:
    build: ./services/ms-enrollments
    container_name: sigei-enrollments
    restart: unless-stopped
    ports:
      - "9084:9084"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-attendance:
    build: ./services/ms-attendance
    container_name: sigei-attendance
    restart: unless-stopped
    ports:
      - "9085:9085"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-grades:
    build: ./services/ms-grades
    container_name: sigei-grades
    restart: unless-stopped
    ports:
      - "9086:9086"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-behavior:
    build: ./services/ms-behavior
    container_name: sigei-behavior
    restart: unless-stopped
    ports:
      - "9087:9087"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-psychology:
    build: ./services/ms-psychology
    container_name: sigei-psychology
    restart: unless-stopped
    ports:
      - "9088:9088"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-events:
    build: ./services/ms-events
    container_name: sigei-events
    restart: unless-stopped
    ports:
      - "9089:9089"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-teacher-assignment:
    build: ./services/ms-teacher-assignment
    container_name: sigei-teacher
    restart: unless-stopped
    ports:
      - "9090:9090"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - DATABASE_URL=r2dbc:postgresql://postgres:5432/sigei
      - DATABASE_USER=sigei
      - DATABASE_PASSWORD=${DB_PASSWORD:-sigei_dev}
      - RABBITMQ_HOST=rabbitmq
    depends_on:
      - eureka
      - postgres
      - rabbitmq

  ms-notification:
    build: ./services/ms-notification
    container_name: sigei-notification
    restart: unless-stopped
    ports:
      - "9091:9091"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - EUREKA_URI=http://eureka:8761/eureka
      - MONGODB_URI=mongodb://sigei:${MONGO_PASSWORD:-sigei_dev}@mongodb:27017/sigei?authSource=admin
      - RABBITMQ_HOST=rabbitmq
      # ConfiguraciÃ³n de proveedores de notificaciÃ³n
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
      - TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}
      - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}
      - FIREBASE_CREDENTIALS=${FIREBASE_CREDENTIALS}
    depends_on:
      - eureka
      - mongodb
      - rabbitmq

  # ============================================================
  # FRONTEND
  # ============================================================

  frontend:
    build: ./frontend/sigei-web
    container_name: sigei-frontend
    restart: unless-stopped
    ports:
      - "3000:80"
    environment:
      - VITE_API_URL=http://gateway:8080
      - VITE_KEYCLOAK_URL=http://keycloak:8080
    depends_on:
      - gateway

volumes:
  postgres_data:
  mongodb_data:
  redis_data:
  rabbitmq_data:

networks:
  default:
    name: sigei-network
```

### 14.3 Docker Compose - ProducciÃ³n (VPC)

```yaml
# docker-compose.prod.yml
version: '3.8'

# Extender del archivo base
# Uso: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  postgres:
    environment:
      POSTGRES_PASSWORD: ${DB_PASSWORD}  # Desde .env seguro
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1'

  mongodb:
    environment:
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1'

  rabbitmq:
    environment:
      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASSWORD}
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'

  keycloak:
    command: start --optimized
    environment:
      KC_HTTP_ENABLED: "false"
      KC_HTTPS_ENABLED: "true"
      KC_HOSTNAME: auth.sigei.vallegrande.edu.pe

  gateway:
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
      replicas: 2

  # Microservicios con lÃ­mites de recursos
  ms-institution:
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.3'

  ms-notification:
    deploy:
      resources:
        limits:
          memory: 768M  # MÃ¡s memoria para procesar notificaciones
          cpus: '0.5'

  # Nginx Reverse Proxy para producciÃ³n
  nginx:
    image: nginx:alpine
    container_name: sigei-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./infrastructure/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./infrastructure/nginx/ssl:/etc/nginx/ssl:ro
      - /var/log/nginx:/var/log/nginx
    depends_on:
      - gateway
      - frontend
```

### 14.4 Archivo .env de Ejemplo

```bash
# .env.example - Copiar a .env y configurar valores reales

# ============================================================
# BASE DE DATOS
# ============================================================
DB_PASSWORD=your_secure_postgres_password_here
MONGO_PASSWORD=your_secure_mongo_password_here

# ============================================================
# MENSAJERÃA
# ============================================================
RABBITMQ_PASSWORD=your_secure_rabbitmq_password_here

# ============================================================
# KEYCLOAK
# ============================================================
KEYCLOAK_PASSWORD=your_secure_keycloak_admin_password

# ============================================================
# NOTIFICACIONES - EMAIL (Gmail/SendGrid/etc)
# ============================================================
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=sigei.notificaciones@vallegrande.edu.pe
SMTP_PASSWORD=your_app_password_here

# ============================================================
# NOTIFICACIONES - SMS (Twilio)
# ============================================================
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# ============================================================
# NOTIFICACIONES - PUSH (Firebase)
# ============================================================
FIREBASE_PROJECT_ID=sigei-notifications
FIREBASE_CREDENTIALS=/path/to/firebase-credentials.json

# ============================================================
# NOTIFICACIONES - WHATSAPP (Twilio WhatsApp)
# ============================================================
TWILIO_WHATSAPP_NUMBER=whatsapp:+14155238886
```

### 14.5 Dockerfile Estandarizado

```dockerfile
# Dockerfile para cada microservicio
FROM eclipse-temurin:17-jdk-alpine as builder

WORKDIR /app

# Copiar archivos de Maven
COPY pom.xml .
COPY .mvn .mvn
COPY mvnw .

# Descargar dependencias
RUN ./mvnw dependency:go-offline

# Copiar cÃ³digo fuente
COPY src src

# Construir
RUN ./mvnw package -DskipTests

# Imagen final
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# Crear usuario no-root
RUN addgroup -S spring && adduser -S spring -G spring
USER spring:spring

# Copiar JAR
COPY --from=builder /app/target/*.jar app.jar

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=30s \
    CMD wget -q --spider http://localhost:${SERVER_PORT}/actuator/health || exit 1

# Variables de entorno por defecto
ENV JAVA_OPTS="-Xms256m -Xmx512m"
ENV SERVER_PORT=8080

EXPOSE ${SERVER_PORT}

ENTRYPOINT ["sh", "-c", "java ${JAVA_OPTS} -jar app.jar"]
```

### 14.6 Scripts de Despliegue

```bash
#!/bin/bash
# deploy.sh - Script de despliegue para VPC

set -e

echo "=========================================="
echo "  SIGEI - Despliegue en VPC"
echo "=========================================="

# Verificar que existe .env
if [ ! -f .env ]; then
    echo "ERROR: Archivo .env no encontrado"
    echo "Copiar .env.example a .env y configurar"
    exit 1
fi

# Cargar variables de entorno
export $(cat .env | grep -v '^#' | xargs)

# OpciÃ³n de despliegue
case "$1" in
    "up")
        echo "Iniciando servicios..."
        docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
        ;;
    "down")
        echo "Deteniendo servicios..."
        docker-compose down
        ;;
    "restart")
        echo "Reiniciando servicios..."
        docker-compose restart
        ;;
    "logs")
        docker-compose logs -f ${2:-}
        ;;
    "build")
        echo "Construyendo imÃ¡genes..."
        docker-compose build --no-cache
        ;;
    "status")
        docker-compose ps
        ;;
    "update")
        echo "Actualizando servicio: $2"
        docker-compose build --no-cache $2
        docker-compose up -d --no-deps $2
        ;;
    *)
        echo "Uso: $0 {up|down|restart|logs|build|status|update <servicio>}"
        exit 1
        ;;
esac

echo "OperaciÃ³n completada."
```

### 14.7 Comandos Ãštiles

```bash
# ============================================================
# DESARROLLO LOCAL
# ============================================================

# Iniciar todo
docker-compose up -d

# Ver logs de todos los servicios
docker-compose logs -f

# Ver logs de un servicio especÃ­fico
docker-compose logs -f ms-notification

# Reconstruir un servicio
docker-compose build ms-notification
docker-compose up -d ms-notification

# Entrar a un contenedor
docker exec -it sigei-notification sh

# Ver estado de RabbitMQ
# Abrir: http://localhost:15672 (user: sigei, pass: sigei_dev)

# Ver estado de Eureka
# Abrir: http://localhost:8761

# ============================================================
# PRODUCCIÃ“N (VPC)
# ============================================================

# Despliegue inicial
./deploy.sh build
./deploy.sh up

# Actualizar un microservicio
./deploy.sh update ms-notification

# Ver logs en producciÃ³n
./deploy.sh logs ms-notification

# Monitorear recursos
docker stats

# Backup de base de datos
docker exec sigei-postgres pg_dump -U sigei sigei > backup_$(date +%Y%m%d).sql
```

---

## ğŸ“‹ Resumen de Decisiones ArquitectÃ³nicas

| DecisiÃ³n | ElecciÃ³n | JustificaciÃ³n |
|----------|----------|---------------|
| **Arquitectura** | Microservicios + Hexagonal + DDD | Escalabilidad, mantenibilidad, aislamiento de dominios |
| **Service Discovery** | Eureka | IntegraciÃ³n nativa con Spring Cloud |
| **API Gateway** | Spring Cloud Gateway | Reactivo, integraciÃ³n con Spring Security |
| **Identity Provider** | Keycloak | Multi-tenancy, On-premise, Open Source, RBAC completo |
| **Base de Datos** | PostgreSQL + MongoDB | Relacional para transacciones, NoSQL para flexibilidad |
| **MensajerÃ­a** | RabbitMQ | Colas de mensajes, simple, Dead Letter Queue nativo |
| **Cache** | Redis | Sesiones, rate limiting, cache distribuido |
| **ConfiguraciÃ³n** | Spring Cloud Config | Centralizada, versionada, segura |
| **Multi-Tenancy** | Discriminator Column | Balance entre aislamiento y costo |

---

*Documento de Arquitectura v1.0 - Febrero 2026*
*Sistema SIGEI - GestiÃ³n Educativa Inicial*
